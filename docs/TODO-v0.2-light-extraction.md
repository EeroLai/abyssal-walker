# TODO - v0.2 輕度搜打撤化改版

## A. Core Loop（P0）
- [x] 在 `GameManager` 新增 `RiskScore` 狀態與重置流程。
- [x] 定義 Risk 累積規則（通關、菁英、事件、Boss）。
- [x] 在 `Game` 主流程加入撤離窗口（每 3 層）。
- [x] 實作撤離/繼續兩種分支邏輯。
- [x] 新增死亡結算（部分保留 + 高價值掉落流失）。
- [ ] 撤離後保留部分 Risk（建議保留 `30%~50%`）。
- [ ] 撤離後起始層規則（避免每次回到第 1 層）。

## B. Loot & Economy（P0）
- [x] 在掉落系統加入 Risk 對詞綴 tier 權重加成。
- [x] 設定 Risk 門檻開啟高階詞綴池（`Risk >= 80`，黃裝機率/詞綴數提升）。
- [ ] 設定 Risk 門檻開啟高階通貨池（`Risk >= 80`）。
- [ ] 深度保底品質：以樓層/ilvl 保證高層不會掉落過爛。
- [ ] Risk 放大品質：在深度保底上再提升高階掉落權重。
- [ ] 低層 Risk 上限：封頂低層反覆刷的 Risk 堆疊。
- [ ] Risk 獲取深度係數：低層少、高層多（依深度倍率）。
- [ ] 同區間重刷遞減：連續刷同區間時掉落效率下降。
- [ ] 調整掉落結構到 70% 通貨、30% 裝備。
- [ ] 保留現有 `alter/augment/refine` 行為相容性。

## C. Currency Expansion（P1）
- [ ] 新增通貨資料：`seal_rune`。
- [ ] 新增通貨資料：`purge_acid`。
- [ ] 新增通貨資料：`infuse_sigil`。
- [ ] CraftingPanel 支援三種新通貨操作入口。
- [ ] 在 tooltip 顯示新通貨用途與風險說明。

## D. UI/UX（P0）
- [x] HUD 顯示 `RiskScore` 與當前品質倍率段位。
- [x] HUD 顯示撤離窗口倒數與按鍵提示。
- [x] 結算畫面顯示：帶出/流失/保留明細。
- [x] 為死亡結算加一條簡潔回饋文字（避免挫折不明）。

## E. Data & Event（P0）
- [x] 在 `EventBus` 新增 Risk/撤離/結算事件。
- [ ] 更新 `data/abyss/floors.json` 支援撤離節點規則。
- [ ] 更新 crafting data（新增通貨定義與參數）。

## F. Balancing（P1）
- [x] 初始參數：每層 `+10 Risk`、高階池 `Risk >= 80`。
- [x] 初始參數：死亡保留基礎通貨 `65%`。
- [ ] 壓測 20 局，確認低層保守刷法不是最優解。
- [ ] 壓測 20 局，確認失敗局仍可完成至少 1 次有效鍛造。
- [ ] 壓測 20 局：`70 -> 76` 反覆撤離仍有合理成長，但非最優解。
- [ ] 壓測 20 局：深推玩法（高風險）期望值高於穩刷玩法。

## G. QA（P0）
- [ ] 測試撤離窗口開關與倒數同步。
- [ ] 測試死亡時背包/地面掉落/結算一致性。
- [ ] 測試 Risk 在新局正確清空。
- [ ] 測試撤離後 Risk 部分保留與 HUD 顯示一致。
- [ ] 測試撤離後起始層規則與存讀檔一致。
- [ ] 測試存讀檔不破壞 v0.1 既有資料。

## H. Release Tasks（P1）
- [ ] 撰寫 `docs/releases/v0.2.0.md`。
- [ ] 更新 `docs/GDD.md`（新增輕度搜打撤循環章節）。
- [ ] 更新 README（簡述新玩法與撤離機制）。

---

## 建議實作順序
1. `深度保底品質 + Risk 放大品質`（先把雙軸規則定型）
2. `撤離保留 Risk + 撤離起始層`（修正重頭爬體感）
3. `低層 Risk 上限 + 重刷遞減`（封住低層最優解）
4. 內部平衡測試（至少 20 局）
5. 上線 P1 通貨擴充
6. 文件與版本說明同步
